(function(e,g){"function"==typeof define&&define.amd?define(g):e.VanillaTree=g()})(this,function(){var e=function(a,b,c,d,q,e,g,f,k,n,m,l){l=function(a,b){return new l.i(a,b)};l.i=function(h,d){c.push.apply(this,h?h.nodeType||h==a?[h]:""+h===h?/</.test(h)?((f=b.createElement(d||"q")).innerHTML=h,f.children):(d&&l(d)[0]||b).querySelectorAll(h):/f/.test(typeof h)?/c/.test(b.readyState)?h():l(b).on("DOMContentLoaded",h):h:c)};l.i[m="prototype"]=(l.extend=function(a){n=arguments;for(f=1;f<n.length;f++)if(m=
n[f])for(k in m)a[k]=m[k];return a})(l.fn=l[m]=c,{on:function(a,b){a=a.split(d);this.map(function(c){(d[f=a[0]+(c.b$=c.b$||++q)]=d[f]||[]).push([b,a[1]]);c["add"+e](a[0],b)});return this},off:function(a,b){a=a.split(d);m="remove"+e;this.map(function(c){if(f=(n=d[a[0]+c.b$])&&n.length)for(;k=n[--f];)b&&b!=k[0]||a[1]&&a[1]!=k[1]||(c[m](a[0],k[0]),n.splice(f,1));else!a[1]&&c[m](a[0],b)});return this},is:function(a){k=(f=this[0])&&(f.matches||f["webkit"+g]||f["moz"+g]||f["ms"+g]);return!!k&&k.call(f,
a)}});return l}(window,document,[],/\.(.+)/,0,"EventListener","MatchesSelector"),g=function(a,b){return e.extend(document.createElement(a),b)},p=function(a,b){var c=this,d=c.container=e(a)[0],d=c.tree=d.appendChild(g("ul",{className:"vtree"}));c.placeholder=b&&b.placeholder;c._placeholder();c.leafs={};d.addEventListener("click",function(a){e(a.target).is(".vtree-leaf-label")?c.select(a.target.parentNode.getAttribute("data-vtree-id")):e(a.target).is(".vtree-toggle")&&c.toggle(a.target.parentNode.getAttribute("data-vtree-id"))});
b&&b.contextmenu&&(d.addEventListener("contextmenu",function(a){var c;e(".vtree-contextmenu").forEach(function(a){a.parentNode.removeChild(a)});e(a.target).is(".vtree-leaf-label")&&(a.preventDefault(),a.stopPropagation(),c=g("menu",{className:"vtree-contextmenu"}),e.extend(c.style,{top:a.offsetY,left:a.offsetX+18,display:"block"}),b.contextmenu.forEach(function(b){c.appendChild(g("li",{className:"vtree-contextmenu-item",innerHTML:b.label})).addEventListener("click",b.action.bind(b,a.target.parentNode.getAttribute("data-vtree-id")))}),
a.target.parentNode.appendChild(c))}),document.addEventListener("click",function(a){e(".vtree-contextmenu").forEach(function(a){a.parentNode.removeChild(a)})}))};p.prototype={constructor:p,_dispatch:function(a,b){var c;try{c=new CustomEvent("vtree-"+a,{bubbles:!0,cancelable:!0,detail:{id:b}})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent("vtree-"+a,!0,!0,{id:b})}(this.getLeaf(b,!0)||this.tree).dispatchEvent(c);return this},_placeholder:function(){var a;!this.tree.children.length&&
this.placeholder?this.tree.innerHTML='<li class="vtree-placeholder">'+this.placeholder+"</li>":(a=this.tree.querySelector(".vtree-placeholder"))&&this.tree.removeChild(a);return this},getLeaf:function(a,b){var c=e('[data-vtree-id="'+a+'"]',this.tree)[0];if(!b&&!c)throw Error('No VanillaTree leaf with id "'+a+'"');return c},getChildList:function(a){var b;a?(b=this.getLeaf(a),(a=e("ul",b)[0])||(a=b.appendChild(g("ul",{className:"vtree-subtree"})))):a=this.tree;return a},add:function(a){var b,c=g("li",
{className:"vtree-leaf"}),d=this.getChildList(a.parent);c.setAttribute("data-vtree-id",b=a.id||Math.random());c.appendChild(g("span",{className:"vtree-toggle"}));c.appendChild(g("a",{className:"vtree-leaf-label",innerHTML:a.label}));d.appendChild(c);d!==this.tree&&d.parentNode.classList.add("vtree-has-children");this.leafs[b]=a;a.opened||this.close(b);a.selected&&this.select(b);return this._placeholder()._dispatch("add",b)},move:function(a,b){var c=this.getLeaf(a),d=c.parentNode,e=this.getLeaf(b,
!0);e&&e.classList.add("vtree-has-children");this.getChildList(b).appendChild(c);d.parentNode.classList.toggle("vtree-has-children",!!d.children.length);return this._dispatch("move",a)},remove:function(a){var b=this.getLeaf(a),c=b.parentNode;c.removeChild(b);c.parentNode.classList.toggle("vtree-has-children",!!c.children.length);return this._placeholder()._dispatch("remove",a)},open:function(a){this.getLeaf(a).classList.remove("closed");return this._dispatch("open",a)},close:function(a){this.getLeaf(a).classList.add("closed");
return this._dispatch("close",a)},toggle:function(a){return this[this.getLeaf(a).classList.contains("closed")?"open":"close"](a)},select:function(a){var b=this.getLeaf(a);b.classList.contains("vtree-selected")||(e("li.vtree-leaf",this.tree).forEach(function(a){a.classList.remove("vtree-selected")}),b.classList.add("vtree-selected"),this._dispatch("select",a));return this}};return p});
